<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="config.mybatis.mapper.oracle.professor">
	<select id="selectPwd" parameterType="String" resultType="String">
		select pwd from professor where prof_no=#{profNo}
	</select>
   
   	<select id="selectByProfNo" parameterType="String" resultType="professorVO">
   		select * from professor where prof_no=#{profNo}
   	</select>
   	<select id="selectSsn" parameterType="string" resultType="string">
   		select ssn from official_info where official_no=#{officicalNo}
   	</select>
   	
   	<select id="loadByProfNo" parameterType="string" resultType="subjectAllVo">
   			select s.*, 
   			 (select count(*) 
   				from subj_time 
   				 where open_sub_code=(select open_sub_code from open_subj 
       			where  prof_no=#{profNo} and SUBJ_CODE=s.subj_code)) count 
				from subject s 
				where prof_no=#{profNo}
   	</select>
	
	<select id="codeByProfNo" parameterType="string" resultType="string">
		select OPEN_SUB_CODE from open_subj where prof_no=#{profNo}
	</select>
	
	
	
   	<select id="timeByCode" resultType="subj_timetableVo" parameterType="list">
   		select t.*, s.subj_name 
   		from subj_time t join subject s 
   		on t.open_sub_code = substr(s.subj_code, 5)
   		<if test="list!=null">
	   		where OPEN_SUB_CODE in
	   		<foreach collection="list" item="item" index="index"
	   			open="(" separator="," close=")">
	   			#{item}
	   		</foreach>
   		</if>
   	</select>
   	
   	<insert id="insertSubjTime" parameterType="subj_timeVo">
   		<selectKey keyProperty="lectureTimeNo" order="BEFORE" resultType="int">
   			select subj_time_seq.nextval from dual
   		</selectKey>
   		insert into subj_time(LECTURE_TIME_NO, OPEN_SUB_CODE, TIMETABLE_CODE, CLASSROOM_CODE)
   		values(#{lectureTimeNo}, #{openSubCode}, #{timetableCode}, #{classroomCode})
   	</insert>
   	
   	<select id="classroomByDepNo" parameterType="string" resultType="map">
   		select * from class where dep_no=#{depNo}
   	</select>
   	
   	<select id="selectViewByProfNo" parameterType="String"
		resultType="map">
		select * from PROFESSOR_VIEW where prof_no=#{profNo}
	</select>
	
	<select id="countByOpenCode" parameterType="string" resultType="int">
		select count(*) from regi_timetable where open_sub_code=#{openSubCode}	
	</select>
   	
   	<select id="selectShortName" parameterType="string" resultType="string">
   		select short_name from timetable where timetable_code=#{timetableCode}
   	</select>
   	
   	<insert id="insertTimetable" parameterType="regi_timetableVo">
   		insert into regi_timetable
   		values(#{openSubCode}, #{shortNames})
   	</insert>
   	<update id="updateTimetable" parameterType="regi_timetableVo">
   		update regi_timetable
   		set short_names = short_names || ',' || #{shortNames}
   		where open_sub_code=#{openSubCode}
   	</update>
   	
</mapper>











